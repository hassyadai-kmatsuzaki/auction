# ãƒ¡ãƒ€ã‚«ãƒ©ã‚¤ãƒ–ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³ã‚·ã‚¹ãƒ†ãƒ  - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆï¼ˆå®Œå…¨ç‰ˆï¼‰

## ğŸ“‹ ç›®æ¬¡

1. [ERå›³æ¦‚è¦](#erå›³æ¦‚è¦)
2. [ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©ï¼ˆå…¨14ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰](#ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©)
3. [ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å›³](#ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å›³)
4. [ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æˆ¦ç•¥](#ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æˆ¦ç•¥)
5. [ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³è¨­è¨ˆ](#ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³è¨­è¨ˆ)
6. [ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§åˆ¶ç´„](#ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§åˆ¶ç´„)
7. [ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–](#ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–)

---

## ERå›³æ¦‚è¦

```
users (ãƒ¦ãƒ¼ã‚¶ãƒ¼)
  â”œâ”€â”€ bids (å…¥æœ­) [å‚åŠ è€…ã¨ã—ã¦]
  â”œâ”€â”€ won_items (è½æœ­) [è½æœ­è€…ã¨ã—ã¦]
  â”œâ”€â”€ deposits (ä¿è¨¼é‡‘) [å‚åŠ è€…ã¨ã—ã¦]
  â”œâ”€â”€ sellers (å‡ºå“è€…æƒ…å ±) [å‡ºå“è€…ã¨ã—ã¦]
  â””â”€â”€ announcements (ãŠçŸ¥ã‚‰ã›ä½œæˆ) [ç®¡ç†è€…ã¨ã—ã¦]

sellers (å‡ºå“è€…)
  â””â”€â”€ items (å‡ºå“å•†å“)

auctions (ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ)
  â”œâ”€â”€ items (ç”Ÿä½“/å•†å“)
  â”œâ”€â”€ lanes (ãƒ¬ãƒ¼ãƒ³)
  â””â”€â”€ auction_deposits (ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³åˆ¥ä¿è¨¼é‡‘è¨­å®š)

items (ç”Ÿä½“/å•†å“)
  â”œâ”€â”€ item_media (ãƒ¡ãƒ‡ã‚£ã‚¢ãƒ•ã‚¡ã‚¤ãƒ«)
  â”œâ”€â”€ bids (å…¥æœ­)
  â”œâ”€â”€ won_items (è½æœ­)
  â””â”€â”€ lane_items (ãƒ¬ãƒ¼ãƒ³å‰²ã‚Šå½“ã¦)

lanes (ãƒ¬ãƒ¼ãƒ³)
  â””â”€â”€ lane_items (ãƒ¬ãƒ¼ãƒ³å•†å“)

announcements (ãŠçŸ¥ã‚‰ã›)
  â””â”€â”€ announcement_reads (æ—¢èª­ç®¡ç†)

system_settings (ã‚·ã‚¹ãƒ†ãƒ è¨­å®š)
```

---

## ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©

### 1. usersï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰

**æ¦‚è¦**: ã‚·ã‚¹ãƒ†ãƒ åˆ©ç”¨è€…å…¨ä½“ï¼ˆç®¡ç†è€…ãƒ»å‚åŠ è€…ï¼‰ã‚’ç®¡ç†

| ã‚«ãƒ©ãƒ å | å‹ | NULL | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | ã‚­ãƒ¼ | èª¬æ˜ |
|---------|---|------|----------|------|------|
| id | BIGINT UNSIGNED | NO | AUTO | PK | ãƒ¦ãƒ¼ã‚¶ãƒ¼ID |
| name | VARCHAR(255) | NO | - | | æ°å |
| email | VARCHAR(255) | NO | - | UNQ | ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ |
| email_verified_at | TIMESTAMP | YES | NULL | | ãƒ¡ãƒ¼ãƒ«èªè¨¼æ—¥æ™‚ |
| password | VARCHAR(255) | NO | - | | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆãƒãƒƒã‚·ãƒ¥åŒ–ï¼‰ |
| user_type | ENUM('admin','participant') | NO | 'participant' | IDX | ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¨®åˆ¥ |
| phone | VARCHAR(20) | YES | NULL | | é›»è©±ç•ªå· |
| postal_code | VARCHAR(10) | YES | NULL | | éƒµä¾¿ç•ªå· |
| prefecture | VARCHAR(50) | YES | NULL | | éƒ½é“åºœçœŒ |
| city | VARCHAR(100) | YES | NULL | | å¸‚åŒºç”ºæ‘ |
| address_line1 | VARCHAR(255) | YES | NULL | | ä½æ‰€1ï¼ˆç•ªåœ°ï¼‰ |
| address_line2 | VARCHAR(255) | YES | NULL | | ä½æ‰€2ï¼ˆå»ºç‰©åç­‰ï¼‰ |
| status | ENUM('pending','approved','suspended','rejected') | NO | 'pending' | IDX | æ‰¿èªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
| approved_at | TIMESTAMP | YES | NULL | | æ‰¿èªæ—¥æ™‚ |
| approved_by | BIGINT UNSIGNED | YES | NULL | FK | æ‰¿èªè€…IDï¼ˆç®¡ç†è€…ï¼‰ |
| rejected_reason | TEXT | YES | NULL | | å´ä¸‹ç†ç”± |
| last_login_at | TIMESTAMP | YES | NULL | | æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³æ—¥æ™‚ |
| is_active | BOOLEAN | NO | TRUE | | ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæœ‰åŠ¹ãƒ•ãƒ©ã‚° |
| remember_token | VARCHAR(100) | YES | NULL | | ãƒ­ã‚°ã‚¤ãƒ³ç¶­æŒãƒˆãƒ¼ã‚¯ãƒ³ |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | | ä½œæˆæ—¥æ™‚ |
| updated_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | | æ›´æ–°æ—¥æ™‚ |
| deleted_at | TIMESTAMP | YES | NULL | | è«–ç†å‰Šé™¤æ—¥æ™‚ |

**ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¨®åˆ¥**
- `admin`: ç®¡ç†è€…ï¼ˆã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³é‹å–¶ï¼‰
- `participant`: å‚åŠ è€…ï¼ˆå…¥æœ­è€…ï¼‰

**æ‰¿èªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**
- `pending`: æ‰¿èªå¾…ã¡ï¼ˆåˆæœŸçŠ¶æ…‹ï¼‰
- `approved`: æ‰¿èªæ¸ˆã¿ï¼ˆå…¥æœ­å¯èƒ½ï¼‰
- `suspended`: åœæ­¢ä¸­ï¼ˆä¸€æ™‚çš„ã«å…¥æœ­ä¸å¯ï¼‰
- `rejected`: å´ä¸‹ï¼ˆç™»éŒ²æ‹’å¦ï¼‰

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**
```sql
PRIMARY KEY (id)
UNIQUE KEY uk_email (email)
INDEX idx_user_type (user_type)
INDEX idx_status (status)
INDEX idx_approved (status, approved_at)
FOREIGN KEY fk_approved_by (approved_by) REFERENCES users(id) ON DELETE SET NULL
```

**åˆ¶ç´„**
- ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ä¸€æ„
- æ‰¿èªè€…ã¯å¿…ãšç®¡ç†è€…ï¼ˆapplicationå±¤ã§åˆ¶å¾¡ï¼‰
- è«–ç†å‰Šé™¤å¯¾å¿œï¼ˆdeleted_atï¼‰

---

### 2. sellersï¼ˆå‡ºå“è€…ï¼‰

**æ¦‚è¦**: ç”Ÿä½“ã‚’å‡ºå“ã™ã‚‹æ¥­è€…ãƒ»å€‹äººã®æƒ…å ±ç®¡ç†

| ã‚«ãƒ©ãƒ å | å‹ | NULL | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | ã‚­ãƒ¼ | èª¬æ˜ |
|---------|---|------|----------|------|------|
| id | BIGINT UNSIGNED | NO | AUTO | PK | å‡ºå“è€…ID |
| seller_code | VARCHAR(50) | NO | - | UNQ | å‡ºå“è€…ã‚³ãƒ¼ãƒ‰ï¼ˆè­˜åˆ¥ç”¨ï¼‰ |
| seller_name | VARCHAR(255) | NO | - | | å‡ºå“è€…åï¼ˆå±‹å·ãƒ»æ°åï¼‰ |
| contact_name | VARCHAR(255) | YES | NULL | | æ‹…å½“è€…å |
| email | VARCHAR(255) | NO | - | IDX | ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ |
| phone | VARCHAR(20) | NO | - | | é›»è©±ç•ªå· |
| postal_code | VARCHAR(10) | YES | NULL | | éƒµä¾¿ç•ªå· |
| prefecture | VARCHAR(50) | YES | NULL | | éƒ½é“åºœçœŒ |
| city | VARCHAR(100) | YES | NULL | | å¸‚åŒºç”ºæ‘ |
| address_line1 | VARCHAR(255) | YES | NULL | | ä½æ‰€1 |
| address_line2 | VARCHAR(255) | YES | NULL | | ä½æ‰€2 |
| bank_name | VARCHAR(100) | YES | NULL | | éŠ€è¡Œå |
| bank_branch | VARCHAR(100) | YES | NULL | | æ”¯åº—å |
| account_type | ENUM('checking','savings') | YES | NULL | | å£åº§ç¨®åˆ¥ |
| account_number | VARCHAR(20) | YES | NULL | | å£åº§ç•ªå· |
| account_holder | VARCHAR(100) | YES | NULL | | å£åº§åç¾© |
| commission_rate | DECIMAL(5,2) | NO | 10.00 | | æ‰‹æ•°æ–™ç‡ï¼ˆ%ï¼‰ |
| notes | TEXT | YES | NULL | | å‚™è€ƒ |
| is_active | BOOLEAN | NO | TRUE | IDX | æœ‰åŠ¹ãƒ•ãƒ©ã‚° |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | | ä½œæˆæ—¥æ™‚ |
| updated_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | | æ›´æ–°æ—¥æ™‚ |

**å£åº§ç¨®åˆ¥**
- `checking`: æ™®é€šé é‡‘
- `savings`: å½“åº§é é‡‘

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**
```sql
PRIMARY KEY (id)
UNIQUE KEY uk_seller_code (seller_code)
INDEX idx_email (email)
INDEX idx_active (is_active)
```

---

### 3. auctionsï¼ˆã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆï¼‰

**æ¦‚è¦**: ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³é–‹å‚¬å˜ä½ã®ç®¡ç†

| ã‚«ãƒ©ãƒ å | å‹ | NULL | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | ã‚­ãƒ¼ | èª¬æ˜ |
|---------|---|------|----------|------|------|
| id | BIGINT UNSIGNED | NO | AUTO | PK | ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³ID |
| title | VARCHAR(255) | NO | - | | ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³å |
| event_date | DATE | NO | - | IDX | é–‹å‚¬æ—¥ |
| start_time | TIME | NO | '10:00:00' | | é–‹å§‹æ™‚åˆ» |
| end_time | TIME | YES | NULL | | çµ‚äº†æ™‚åˆ»ï¼ˆå®Ÿç¸¾ï¼‰ |
| status | ENUM('preparing','scheduled','live','finished','cancelled') | NO | 'preparing' | IDX | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
| description | TEXT | YES | NULL | | èª¬æ˜ |
| lane_count | TINYINT UNSIGNED | NO | 6 | | ãƒ¬ãƒ¼ãƒ³æ•° |
| default_bid_increment | DECIMAL(10,2) | NO | 100.00 | | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå…¥æœ­å˜ä½ |
| countdown_seconds | INT UNSIGNED | NO | 3 | | ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ç§’æ•° |
| deposit_required | BOOLEAN | NO | FALSE | | ä¿è¨¼é‡‘å¿…é ˆãƒ•ãƒ©ã‚° |
| upload_deadline | TIMESTAMP | YES | NULL | | å•†å“ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æœŸé™ |
| payment_deadline_hours | INT UNSIGNED | NO | 24 | | å…¥é‡‘æœŸé™ï¼ˆæ™‚é–“ï¼‰ |
| shipping_deadline_hours | INT UNSIGNED | NO | 48 | | ç™ºé€æœŸé™ï¼ˆæ™‚é–“ï¼‰ |
| created_by | BIGINT UNSIGNED | NO | - | FK | ä½œæˆè€…IDï¼ˆç®¡ç†è€…ï¼‰ |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | | ä½œæˆæ—¥æ™‚ |
| updated_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | | æ›´æ–°æ—¥æ™‚ |

**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**
- `preparing`: æº–å‚™ä¸­ï¼ˆç·¨é›†å¯èƒ½ï¼‰
- `scheduled`: äºˆå®šï¼ˆå•†å“ç™»éŒ²å®Œäº†ï¼‰
- `live`: é–‹å‚¬ä¸­ï¼ˆå…¥æœ­å¯èƒ½ï¼‰
- `finished`: çµ‚äº†ï¼ˆç·¨é›†ãƒ»å‰Šé™¤ä¸å¯ï¼‰
- `cancelled`: ã‚­ãƒ£ãƒ³ã‚»ãƒ«

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**
```sql
PRIMARY KEY (id)
INDEX idx_event_date (event_date)
INDEX idx_status (status)
INDEX idx_event_status (event_date, status)
FOREIGN KEY fk_created_by (created_by) REFERENCES users(id) ON DELETE RESTRICT
```

**åˆ¶ç´„**
- `status = 'finished'` ã®å ´åˆã€ç·¨é›†ãƒ»å‰Šé™¤ä¸å¯ï¼ˆapplicationå±¤ã§åˆ¶å¾¡ï¼‰
- `lane_count` ã¯1ã€œ10ã®ç¯„å›²ï¼ˆCHECKåˆ¶ç´„ï¼‰

---

### 4. auction_depositsï¼ˆã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³åˆ¥ä¿è¨¼é‡‘è¨­å®šï¼‰

**æ¦‚è¦**: ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³ã”ã¨ã®ä¿è¨¼é‡‘è¨­å®š

| ã‚«ãƒ©ãƒ å | å‹ | NULL | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | ã‚­ãƒ¼ | èª¬æ˜ |
|---------|---|------|----------|------|------|
| id | BIGINT UNSIGNED | NO | AUTO | PK | ID |
| auction_id | BIGINT UNSIGNED | NO | - | FK,UNQ | ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³ID |
| deposit_amount | DECIMAL(10,2) | NO | 0.00 | | ä¿è¨¼é‡‘é¡ |
| deposit_type | ENUM('none','fixed','flexible') | NO | 'none' | | ä¿è¨¼é‡‘ã‚¿ã‚¤ãƒ— |
| description | TEXT | YES | NULL | | èª¬æ˜ |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | | ä½œæˆæ—¥æ™‚ |
| updated_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | | æ›´æ–°æ—¥æ™‚ |

**ä¿è¨¼é‡‘ã‚¿ã‚¤ãƒ—**
- `none`: ä¿è¨¼é‡‘ãªã—
- `fixed`: ä¸€å¾‹å›ºå®šï¼ˆä¸»å‚¬è€…å´ã§è¨­å®šï¼‰
- `flexible`: å‚åŠ è€…ãŒè‡ªç”±ã«è¨­å®š

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**
```sql
PRIMARY KEY (id)
UNIQUE KEY uk_auction (auction_id)
FOREIGN KEY fk_auction_id (auction_id) REFERENCES auctions(id) ON DELETE CASCADE
```

---

### 5. depositsï¼ˆä¿è¨¼é‡‘ç®¡ç†ï¼‰

**æ¦‚è¦**: å‚åŠ è€…ã®ä¿è¨¼é‡‘é ã‹ã‚ŠçŠ¶æ³

| ã‚«ãƒ©ãƒ å | å‹ | NULL | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | ã‚­ãƒ¼ | èª¬æ˜ |
|---------|---|------|----------|------|------|
| id | BIGINT UNSIGNED | NO | AUTO | PK | ä¿è¨¼é‡‘ID |
| auction_id | BIGINT UNSIGNED | NO | - | FK,IDX | ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³ID |
| user_id | BIGINT UNSIGNED | NO | - | FK,IDX | ãƒ¦ãƒ¼ã‚¶ãƒ¼ID |
| deposit_amount | DECIMAL(10,2) | NO | 0.00 | | é ã‹ã‚Šé‡‘é¡ |
| payment_method | ENUM('bank_transfer','credit_card','cash') | NO | 'bank_transfer' | | æ”¯æ‰•ã„æ–¹æ³• |
| payment_status | ENUM('pending','confirmed','refunded','forfeited') | NO | 'pending' | IDX | æ”¯æ‰•ã„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
| paid_at | TIMESTAMP | YES | NULL | | å…¥é‡‘æ—¥æ™‚ |
| refunded_at | TIMESTAMP | YES | NULL | | è¿”é‡‘æ—¥æ™‚ |
| refund_amount | DECIMAL(10,2) | YES | NULL | | è¿”é‡‘é¡ |
| notes | TEXT | YES | NULL | | å‚™è€ƒ |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | | ä½œæˆæ—¥æ™‚ |
| updated_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | | æ›´æ–°æ—¥æ™‚ |

**æ”¯æ‰•ã„æ–¹æ³•**
- `bank_transfer`: éŠ€è¡ŒæŒ¯è¾¼
- `credit_card`: ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰
- `cash`: ç¾é‡‘

**æ”¯æ‰•ã„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**
- `pending`: å…¥é‡‘å¾…ã¡
- `confirmed`: å…¥é‡‘ç¢ºèªæ¸ˆã¿
- `refunded`: è¿”é‡‘æ¸ˆã¿
- `forfeited`: æ²¡åï¼ˆãƒšãƒŠãƒ«ãƒ†ã‚£ï¼‰

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**
```sql
PRIMARY KEY (id)
UNIQUE KEY uk_auction_user (auction_id, user_id)
INDEX idx_user (user_id)
INDEX idx_payment_status (payment_status)
FOREIGN KEY fk_auction_id (auction_id) REFERENCES auctions(id) ON DELETE CASCADE
FOREIGN KEY fk_user_id (user_id) REFERENCES users(id) ON DELETE CASCADE
```

---

### 6. itemsï¼ˆç”Ÿä½“/å•†å“ï¼‰

**æ¦‚è¦**: ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³å‡ºå“å•†å“ï¼ˆãƒ¡ãƒ€ã‚«å€‹ä½“ï¼‰

| ã‚«ãƒ©ãƒ å | å‹ | NULL | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | ã‚­ãƒ¼ | èª¬æ˜ |
|---------|---|------|----------|------|------|
| id | BIGINT UNSIGNED | NO | AUTO | PK | ç”Ÿä½“ID |
| auction_id | BIGINT UNSIGNED | NO | - | FK,IDX | ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³ID |
| seller_id | BIGINT UNSIGNED | NO | - | FK,IDX | å‡ºå“è€…ID |
| item_number | INT UNSIGNED | NO | - | IDX | ç”Ÿä½“ç•ªå·ï¼ˆã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³å†…ï¼‰ |
| species_name | VARCHAR(255) | NO | - | | å“ç¨®å |
| quantity | INT UNSIGNED | NO | 1 | | åŒ¹æ•° |
| start_price | DECIMAL(10,2) | NO | 100.00 | | é–‹å§‹ä¾¡æ ¼ï¼ˆ1åŒ¹ã‚ãŸã‚Šï¼‰ |
| current_price | DECIMAL(10,2) | NO | 100.00 | | ç¾åœ¨ä¾¡æ ¼ï¼ˆ1åŒ¹ã‚ãŸã‚Šï¼‰ |
| reserve_price | DECIMAL(10,2) | YES | NULL | | æœ€ä½è½æœ­ä¾¡æ ¼ |
| estimated_price | DECIMAL(10,2) | YES | NULL | | è½æœ­æƒ³å®šé‡‘é¡ |
| bid_increment | DECIMAL(10,2) | NO | 100.00 | | å…¥æœ­å˜ä½ |
| inspection_info | TEXT | YES | NULL | | å¯©æŸ»æƒ…å ± |
| individual_info | TEXT | YES | NULL | | å€‹ä½“æƒ…å ±ï¼ˆå‡ºå“è€…è¨˜è¼‰ï¼‰ |
| notes | TEXT | YES | NULL | | å‚™è€ƒ |
| is_premium | BOOLEAN | NO | FALSE | IDX | ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³ãƒ•ãƒ©ã‚° |
| premium_fee | DECIMAL(10,2) | YES | NULL | | ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³æ–™é‡‘ |
| thumbnail_path | VARCHAR(500) | YES | NULL | | ã‚µãƒ ãƒã‚¤ãƒ«ç”»åƒãƒ‘ã‚¹ |
| status | ENUM('draft','registered','live','sold','unsold','cancelled') | NO | 'draft' | IDX | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
| unsold_action | ENUM('return','free_pickup','relist') | YES | 'return' | | æœªè½æœ­æ™‚å¯¾å¿œ |
| storage_fee | DECIMAL(10,2) | YES | NULL | | ä¿ç®¡æ–™ï¼ˆæ¬¡å›å‡ºå“æ™‚ï¼‰ |
| live_started_at | TIMESTAMP | YES | NULL | | ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³é–‹å§‹æ—¥æ™‚ |
| live_ended_at | TIMESTAMP | YES | NULL | | ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³çµ‚äº†æ—¥æ™‚ |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | | ä½œæˆæ—¥æ™‚ |
| updated_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | | æ›´æ–°æ—¥æ™‚ |

**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**
- `draft`: ä¸‹æ›¸ã
- `registered`: ç™»éŒ²æ¸ˆã¿ï¼ˆã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³å‰ï¼‰
- `live`: ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³ä¸­
- `sold`: è½æœ­æ¸ˆã¿
- `unsold`: æœªè½æœ­
- `cancelled`: ã‚­ãƒ£ãƒ³ã‚»ãƒ«

**æœªè½æœ­æ™‚å¯¾å¿œ**
- `return`: è¿”é€ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
- `free_pickup`: ç„¡æ–™å¼•å–å¸Œæœ›
- `relist`: æ¬¡å›ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³å‡ºå“ï¼ˆä¿ç®¡æ–™è«‹æ±‚ï¼‰

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**
```sql
PRIMARY KEY (id)
UNIQUE KEY uk_auction_item_number (auction_id, item_number)
INDEX idx_auction (auction_id)
INDEX idx_seller (seller_id)
INDEX idx_status (status)
INDEX idx_premium (is_premium)
INDEX idx_auction_status (auction_id, status, item_number)
FOREIGN KEY fk_auction_id (auction_id) REFERENCES auctions(id) ON DELETE CASCADE
FOREIGN KEY fk_seller_id (seller_id) REFERENCES sellers(id) ON DELETE RESTRICT
```

**åˆ¶ç´„**
- `quantity` ã¯1ä»¥ä¸Šï¼ˆCHECKåˆ¶ç´„ï¼‰
- `current_price >= start_price`ï¼ˆapplicationå±¤ã§åˆ¶å¾¡ï¼‰

---

### 7. item_mediaï¼ˆç”Ÿä½“ãƒ¡ãƒ‡ã‚£ã‚¢ï¼‰

**æ¦‚è¦**: å•†å“ã®ç”»åƒãƒ»å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†

| ã‚«ãƒ©ãƒ å | å‹ | NULL | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | ã‚­ãƒ¼ | èª¬æ˜ |
|---------|---|------|----------|------|------|
| id | BIGINT UNSIGNED | NO | AUTO | PK | ãƒ¡ãƒ‡ã‚£ã‚¢ID |
| item_id | BIGINT UNSIGNED | NO | - | FK,IDX | ç”Ÿä½“ID |
| media_type | ENUM('video_top','video_side','photo_top','photo_side','photo_other') | NO | - | IDX | ãƒ¡ãƒ‡ã‚£ã‚¢ç¨®åˆ¥ |
| file_path | VARCHAR(500) | NO | - | | ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ |
| file_name | VARCHAR(255) | NO | - | | ãƒ•ã‚¡ã‚¤ãƒ«å |
| file_size | BIGINT UNSIGNED | YES | NULL | | ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºï¼ˆãƒã‚¤ãƒˆï¼‰ |
| mime_type | VARCHAR(100) | YES | NULL | | MIMEã‚¿ã‚¤ãƒ— |
| duration | INT UNSIGNED | YES | NULL | | å†ç”Ÿæ™‚é–“ï¼ˆç§’ã€å‹•ç”»ã®ã¿ï¼‰ |
| width | INT UNSIGNED | YES | NULL | | å¹…ï¼ˆãƒ”ã‚¯ã‚»ãƒ«ï¼‰ |
| height | INT UNSIGNED | YES | NULL | | é«˜ã•ï¼ˆãƒ”ã‚¯ã‚»ãƒ«ï¼‰ |
| display_order | INT UNSIGNED | NO | 0 | | è¡¨ç¤ºé †åº |
| is_thumbnail | BOOLEAN | NO | FALSE | | ã‚µãƒ ãƒã‚¤ãƒ«ãƒ•ãƒ©ã‚° |
| uploaded_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | | ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ—¥æ™‚ |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | | ä½œæˆæ—¥æ™‚ |
| updated_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | | æ›´æ–°æ—¥æ™‚ |

**ãƒ¡ãƒ‡ã‚£ã‚¢ç¨®åˆ¥**
- `video_top`: ä¸Šè¦‹å‹•ç”»ï¼ˆ30ç§’ï¼‰
- `video_side`: æ¨ªè¦‹å‹•ç”»ï¼ˆ30ç§’ï¼‰
- `photo_top`: ä¸Šè¦‹å†™çœŸï¼ˆãƒ—ãƒ¬ãƒŸã‚¢ãƒ ï¼‰
- `photo_side`: æ¨ªè¦‹å†™çœŸï¼ˆãƒ—ãƒ¬ãƒŸã‚¢ãƒ ï¼‰
- `photo_other`: ãã®ä»–å†™çœŸï¼ˆãƒ—ãƒ¬ãƒŸã‚¢ãƒ ï¼‰

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**
```sql
PRIMARY KEY (id)
INDEX idx_item (item_id)
INDEX idx_item_type (item_id, media_type)
INDEX idx_item_order (item_id, display_order)
FOREIGN KEY fk_item_id (item_id) REFERENCES items(id) ON DELETE CASCADE
```

---

### 8. lanesï¼ˆãƒ¬ãƒ¼ãƒ³ï¼‰

**æ¦‚è¦**: ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³é€²è¡Œã®ãƒ¬ãƒ¼ãƒ³ç®¡ç†

| ã‚«ãƒ©ãƒ å | å‹ | NULL | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | ã‚­ãƒ¼ | èª¬æ˜ |
|---------|---|------|----------|------|------|
| id | BIGINT UNSIGNED | NO | AUTO | PK | ãƒ¬ãƒ¼ãƒ³ID |
| auction_id | BIGINT UNSIGNED | NO | - | FK,IDX | ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³ID |
| lane_number | TINYINT UNSIGNED | NO | - | IDX | ãƒ¬ãƒ¼ãƒ³ç•ªå·ï¼ˆ1-6ï¼‰ |
| lane_name | VARCHAR(100) | YES | NULL | | ãƒ¬ãƒ¼ãƒ³å |
| current_item_id | BIGINT UNSIGNED | YES | NULL | FK | ç¾åœ¨ã®ç”Ÿä½“ID |
| status | ENUM('waiting','active','paused','finished') | NO | 'waiting' | IDX | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
| started_at | TIMESTAMP | YES | NULL | | é–‹å§‹æ—¥æ™‚ |
| finished_at | TIMESTAMP | YES | NULL | | çµ‚äº†æ—¥æ™‚ |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | | ä½œæˆæ—¥æ™‚ |
| updated_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | | æ›´æ–°æ—¥æ™‚ |

**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**
- `waiting`: å¾…æ©Ÿä¸­
- `active`: é€²è¡Œä¸­
- `paused`: ä¸€æ™‚åœæ­¢
- `finished`: çµ‚äº†

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**
```sql
PRIMARY KEY (id)
UNIQUE KEY uk_auction_lane (auction_id, lane_number)
INDEX idx_auction (auction_id)
INDEX idx_status (status)
FOREIGN KEY fk_auction_id (auction_id) REFERENCES auctions(id) ON DELETE CASCADE
FOREIGN KEY fk_current_item_id (current_item_id) REFERENCES items(id) ON DELETE SET NULL
```

---

### 9. lane_itemsï¼ˆãƒ¬ãƒ¼ãƒ³å•†å“å‰²ã‚Šå½“ã¦ï¼‰

**æ¦‚è¦**: å„ãƒ¬ãƒ¼ãƒ³ã¸ã®å•†å“å‰²ã‚Šå½“ã¦ã¨é€²è¡Œé †åº

| ã‚«ãƒ©ãƒ å | å‹ | NULL | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | ã‚­ãƒ¼ | èª¬æ˜ |
|---------|---|------|----------|------|------|
| id | BIGINT UNSIGNED | NO | AUTO | PK | ID |
| lane_id | BIGINT UNSIGNED | NO | - | FK,IDX | ãƒ¬ãƒ¼ãƒ³ID |
| item_id | BIGINT UNSIGNED | NO | - | FK,UNQ | ç”Ÿä½“ID |
| sequence_order | INT UNSIGNED | NO | - | IDX | ãƒ¬ãƒ¼ãƒ³å†…é †åº |
| started_at | TIMESTAMP | YES | NULL | | é–‹å§‹æ—¥æ™‚ |
| finished_at | TIMESTAMP | YES | NULL | | çµ‚äº†æ—¥æ™‚ |
| duration_seconds | INT UNSIGNED | YES | NULL | | æ‰€è¦æ™‚é–“ï¼ˆç§’ï¼‰ |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | | ä½œæˆæ—¥æ™‚ |
| updated_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | | æ›´æ–°æ—¥æ™‚ |

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**
```sql
PRIMARY KEY (id)
UNIQUE KEY uk_item (item_id)
INDEX idx_lane_order (lane_id, sequence_order)
INDEX idx_lane (lane_id)
FOREIGN KEY fk_lane_id (lane_id) REFERENCES lanes(id) ON DELETE CASCADE
FOREIGN KEY fk_item_id (item_id) REFERENCES items(id) ON DELETE CASCADE
```

**åˆ¶ç´„**
- 1å•†å“ã¯1ãƒ¬ãƒ¼ãƒ³ã«ã®ã¿å‰²ã‚Šå½“ã¦å¯èƒ½ï¼ˆuk_itemï¼‰
- åŒä¸€å‡ºå“è€…ã®å•†å“ã¯åŒã˜ãƒ¬ãƒ¼ãƒ³ã«å›ºã‚ã‚‹ï¼ˆapplicationå±¤ã§åˆ¶å¾¡ï¼‰

---

### 10. bidsï¼ˆå…¥æœ­ï¼‰

**æ¦‚è¦**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å…¥æœ­è¨˜éŒ²

| ã‚«ãƒ©ãƒ å | å‹ | NULL | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | ã‚­ãƒ¼ | èª¬æ˜ |
|---------|---|------|----------|------|------|
| id | BIGINT UNSIGNED | NO | AUTO | PK | å…¥æœ­ID |
| item_id | BIGINT UNSIGNED | NO | - | FK,IDX | ç”Ÿä½“ID |
| bidder_id | BIGINT UNSIGNED | NO | - | FK,IDX | å…¥æœ­è€…ID |
| bid_price | DECIMAL(10,2) | NO | - | | å…¥æœ­ä¾¡æ ¼ï¼ˆ1åŒ¹ã‚ãŸã‚Šï¼‰ |
| total_amount | DECIMAL(10,2) | NO | - | | åˆè¨ˆé‡‘é¡ï¼ˆä¾¡æ ¼Ã—åŒ¹æ•°ï¼‰ |
| is_active | BOOLEAN | NO | TRUE | IDX | ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ•ãƒ©ã‚°ï¼ˆON/OFFï¼‰ |
| bid_type | ENUM('manual','auto') | NO | 'manual' | | å…¥æœ­ã‚¿ã‚¤ãƒ— |
| ip_address | VARCHAR(45) | YES | NULL | | IPã‚¢ãƒ‰ãƒ¬ã‚¹ |
| user_agent | TEXT | YES | NULL | | ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | IDX | ä½œæˆæ—¥æ™‚ |
| updated_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | | æ›´æ–°æ—¥æ™‚ |

**å…¥æœ­ã‚¿ã‚¤ãƒ—**
- `manual`: æ‰‹å‹•å…¥æœ­
- `auto`: è‡ªå‹•ä¸Šæ˜‡ï¼ˆè¤‡æ•°äººå…¥æœ­æ™‚ï¼‰

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**
```sql
PRIMARY KEY (id)
INDEX idx_item_active (item_id, is_active, created_at DESC)
INDEX idx_item_created (item_id, created_at DESC)
INDEX idx_bidder (bidder_id)
INDEX idx_created (created_at)
FOREIGN KEY fk_item_id (item_id) REFERENCES items(id) ON DELETE CASCADE
FOREIGN KEY fk_bidder_id (bidder_id) REFERENCES users(id) ON DELETE CASCADE
```

**åˆ¶ç´„**
- æ‰¿èªæ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿å…¥æœ­å¯èƒ½ï¼ˆapplicationå±¤ã§åˆ¶å¾¡ï¼‰
- `bid_price >= item.current_price + item.bid_increment`ï¼ˆapplicationå±¤ã§åˆ¶å¾¡ï¼‰

---

### 11. won_itemsï¼ˆè½æœ­ï¼‰

**æ¦‚è¦**: è½æœ­æƒ…å ±ã¨å—å–ãƒ»é…é€ç®¡ç†

| ã‚«ãƒ©ãƒ å | å‹ | NULL | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | ã‚­ãƒ¼ | èª¬æ˜ |
|---------|---|------|----------|------|------|
| id | BIGINT UNSIGNED | NO | AUTO | PK | è½æœ­ID |
| item_id | BIGINT UNSIGNED | NO | - | FK,UNQ | ç”Ÿä½“ID |
| winner_id | BIGINT UNSIGNED | NO | - | FK,IDX | è½æœ­è€…ID |
| winning_price | DECIMAL(10,2) | NO | - | | è½æœ­ä¾¡æ ¼ï¼ˆ1åŒ¹ã‚ãŸã‚Šï¼‰ |
| quantity | INT UNSIGNED | NO | - | | åŒ¹æ•° |
| total_amount | DECIMAL(10,2) | NO | - | | åˆè¨ˆé‡‘é¡ |
| commission_rate | DECIMAL(5,2) | NO | 10.00 | | æ‰‹æ•°æ–™ç‡ï¼ˆ%ï¼‰ |
| commission_amount | DECIMAL(10,2) | NO | 0.00 | | æ‰‹æ•°æ–™é¡ |
| seller_amount | DECIMAL(10,2) | NO | 0.00 | | å‡ºå“è€…å—å–é¡ |
| payment_status | ENUM('pending','paid','confirmed','refunded') | NO | 'pending' | IDX | æ”¯æ‰•ã„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
| payment_method | ENUM('bank_transfer','credit_card','cash','onsite') | YES | NULL | | æ”¯æ‰•ã„æ–¹æ³• |
| paid_at | TIMESTAMP | YES | NULL | | å…¥é‡‘æ—¥æ™‚ |
| payment_confirmed_at | TIMESTAMP | YES | NULL | | å…¥é‡‘ç¢ºèªæ—¥æ™‚ |
| payment_deadline | TIMESTAMP | YES | NULL | IDX | å…¥é‡‘æœŸé™ |
| delivery_method | ENUM('shipping','pickup') | NO | 'shipping' | | å—å–æ–¹æ³• |
| pickup_datetime | TIMESTAMP | YES | NULL | | ç¾åœ°å¼•å–å¸Œæœ›æ—¥æ™‚ |
| pickup_timeslot | ENUM('day1_10-12','day1_12-14','day1_14-16','day1_16-18','day2_10-12','day2_12-14','day2_14-16','day2_16-18') | YES | NULL | | å¼•å–æ™‚é–“å¸¯ |
| delivery_status | ENUM('pending','preparing','shipped','completed','cancelled') | NO | 'pending' | IDX | ç™ºé€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
| shipping_postal_code | VARCHAR(10) | YES | NULL | | é…é€å…ˆéƒµä¾¿ç•ªå· |
| shipping_prefecture | VARCHAR(50) | YES | NULL | | é…é€å…ˆéƒ½é“åºœçœŒ |
| shipping_city | VARCHAR(100) | YES | NULL | | é…é€å…ˆå¸‚åŒºç”ºæ‘ |
| shipping_address_line1 | VARCHAR(255) | YES | NULL | | é…é€å…ˆä½æ‰€1 |
| shipping_address_line2 | VARCHAR(255) | YES | NULL | | é…é€å…ˆä½æ‰€2 |
| shipping_name | VARCHAR(255) | YES | NULL | | å—å–äººæ°å |
| shipping_phone | VARCHAR(20) | YES | NULL | | å—å–äººé›»è©±ç•ªå· |
| shipping_company | VARCHAR(100) | YES | NULL | | é…é€æ¥­è€… |
| tracking_number | VARCHAR(100) | YES | NULL | | è¿½è·¡ç•ªå· |
| shipped_at | TIMESTAMP | YES | NULL | | ç™ºé€æ—¥æ™‚ |
| delivered_at | TIMESTAMP | YES | NULL | | é…é”å®Œäº†æ—¥æ™‚ |
| notes | TEXT | YES | NULL | | å‚™è€ƒ |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | | ä½œæˆæ—¥æ™‚ |
| updated_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | | æ›´æ–°æ—¥æ™‚ |

**æ”¯æ‰•ã„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**
- `pending`: æ”¯æ‰•ã„å¾…ã¡
- `paid`: æ”¯æ‰•ã„æ¸ˆã¿ï¼ˆç¢ºèªå¾…ã¡ï¼‰
- `confirmed`: å…¥é‡‘ç¢ºèªæ¸ˆã¿
- `refunded`: è¿”é‡‘æ¸ˆã¿

**å—å–æ–¹æ³•**
- `shipping`: é…é€
- `pickup`: ç¾åœ°å¼•å–

**å¼•å–æ™‚é–“å¸¯**
- `day1_10-12`: å½“æ—¥10-12æ™‚
- `day1_12-14`: å½“æ—¥12-14æ™‚
- `day1_14-16`: å½“æ—¥14-16æ™‚
- `day1_16-18`: å½“æ—¥16-18æ™‚
- `day2_10-12`: ç¿Œæ—¥10-12æ™‚
- `day2_12-14`: ç¿Œæ—¥12-14æ™‚
- `day2_14-16`: ç¿Œæ—¥14-16æ™‚
- `day2_16-18`: ç¿Œæ—¥16-18æ™‚

**ç™ºé€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**
- `pending`: ç™ºé€å¾…ã¡
- `preparing`: æº–å‚™ä¸­
- `shipped`: ç™ºé€æ¸ˆã¿
- `completed`: å®Œäº†ï¼ˆé…é”æ¸ˆã¿ï¼‰
- `cancelled`: ã‚­ãƒ£ãƒ³ã‚»ãƒ«

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**
```sql
PRIMARY KEY (id)
UNIQUE KEY uk_item (item_id)
INDEX idx_winner (winner_id)
INDEX idx_payment_status (payment_status)
INDEX idx_payment_deadline (payment_deadline)
INDEX idx_delivery_status (delivery_status)
INDEX idx_winner_payment (winner_id, payment_status)
FOREIGN KEY fk_item_id (item_id) REFERENCES items(id) ON DELETE RESTRICT
FOREIGN KEY fk_winner_id (winner_id) REFERENCES users(id) ON DELETE RESTRICT
```

**åˆ¶ç´„**
- 1å•†å“ã«ã¤ã1è½æœ­ã®ã¿ï¼ˆuk_itemï¼‰
- `total_amount = winning_price * quantity`ï¼ˆapplicationå±¤ã§åˆ¶å¾¡ï¼‰
- `seller_amount = total_amount - commission_amount`ï¼ˆapplicationå±¤ã§åˆ¶å¾¡ï¼‰

---

### 12. announcementsï¼ˆãŠçŸ¥ã‚‰ã›ï¼‰

**æ¦‚è¦**: ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰ã®ãŠçŸ¥ã‚‰ã›é…ä¿¡

| ã‚«ãƒ©ãƒ å | å‹ | NULL | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | ã‚­ãƒ¼ | èª¬æ˜ |
|---------|---|------|----------|------|------|
| id | BIGINT UNSIGNED | NO | AUTO | PK | ãŠçŸ¥ã‚‰ã›ID |
| title | VARCHAR(255) | NO | - | | ã‚¿ã‚¤ãƒˆãƒ« |
| content | TEXT | NO | - | | æœ¬æ–‡ |
| announcement_type | ENUM('general','auction','system','maintenance') | NO | 'general' | IDX | ãŠçŸ¥ã‚‰ã›ç¨®åˆ¥ |
| target_audience | ENUM('all','participants','admins') | NO | 'all' | | å¯¾è±¡è€… |
| is_published | BOOLEAN | NO | FALSE | IDX | å…¬é–‹ãƒ•ãƒ©ã‚° |
| published_at | TIMESTAMP | YES | NULL | IDX | å…¬é–‹æ—¥æ™‚ |
| expires_at | TIMESTAMP | YES | NULL | IDX | æœ‰åŠ¹æœŸé™ |
| priority | ENUM('low','normal','high','urgent') | NO | 'normal' | | å„ªå…ˆåº¦ |
| is_pinned | BOOLEAN | NO | FALSE | | ãƒ”ãƒ³ç•™ã‚ãƒ•ãƒ©ã‚° |
| auction_id | BIGINT UNSIGNED | YES | NULL | FK,IDX | é–¢é€£ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³ID |
| created_by | BIGINT UNSIGNED | NO | - | FK | ä½œæˆè€…ID |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | | ä½œæˆæ—¥æ™‚ |
| updated_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | | æ›´æ–°æ—¥æ™‚ |

**ãŠçŸ¥ã‚‰ã›ç¨®åˆ¥**
- `general`: ä¸€èˆ¬
- `auction`: ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³é–¢é€£
- `system`: ã‚·ã‚¹ãƒ†ãƒ 
- `maintenance`: ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹

**å¯¾è±¡è€…**
- `all`: å…¨å“¡
- `participants`: å‚åŠ è€…ã®ã¿
- `admins`: ç®¡ç†è€…ã®ã¿

**å„ªå…ˆåº¦**
- `low`: ä½
- `normal`: é€šå¸¸
- `high`: é«˜ï¼ˆé‡è¦ï¼‰
- `urgent`: ç·Šæ€¥

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**
```sql
PRIMARY KEY (id)
INDEX idx_published (is_published, published_at DESC)
INDEX idx_expires (expires_at)
INDEX idx_type (announcement_type)
INDEX idx_auction (auction_id)
INDEX idx_active (is_published, published_at, expires_at)
FOREIGN KEY fk_auction_id (auction_id) REFERENCES auctions(id) ON DELETE CASCADE
FOREIGN KEY fk_created_by (created_by) REFERENCES users(id) ON DELETE RESTRICT
```

---

### 13. announcement_readsï¼ˆãŠçŸ¥ã‚‰ã›æ—¢èª­ç®¡ç†ï¼‰

**æ¦‚è¦**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã®ãŠçŸ¥ã‚‰ã›æ—¢èª­çŠ¶æ…‹

| ã‚«ãƒ©ãƒ å | å‹ | NULL | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | ã‚­ãƒ¼ | èª¬æ˜ |
|---------|---|------|----------|------|------|
| id | BIGINT UNSIGNED | NO | AUTO | PK | ID |
| announcement_id | BIGINT UNSIGNED | NO | - | FK,IDX | ãŠçŸ¥ã‚‰ã›ID |
| user_id | BIGINT UNSIGNED | NO | - | FK,IDX | ãƒ¦ãƒ¼ã‚¶ãƒ¼ID |
| read_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | | æ—¢èª­æ—¥æ™‚ |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | | ä½œæˆæ—¥æ™‚ |

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**
```sql
PRIMARY KEY (id)
UNIQUE KEY uk_announcement_user (announcement_id, user_id)
INDEX idx_user (user_id)
FOREIGN KEY fk_announcement_id (announcement_id) REFERENCES announcements(id) ON DELETE CASCADE
FOREIGN KEY fk_user_id (user_id) REFERENCES users(id) ON DELETE CASCADE
```

---

### 14. system_settingsï¼ˆã‚·ã‚¹ãƒ†ãƒ è¨­å®šï¼‰

**æ¦‚è¦**: ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®è¨­å®šç®¡ç†

| ã‚«ãƒ©ãƒ å | å‹ | NULL | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | ã‚­ãƒ¼ | èª¬æ˜ |
|---------|---|------|----------|------|------|
| id | BIGINT UNSIGNED | NO | AUTO | PK | è¨­å®šID |
| setting_key | VARCHAR(255) | NO | - | UNQ | è¨­å®šã‚­ãƒ¼ |
| setting_value | TEXT | NO | - | | è¨­å®šå€¤ |
| value_type | ENUM('string','integer','decimal','boolean','json') | NO | 'string' | | å€¤ã®å‹ |
| category | VARCHAR(100) | NO | 'general' | IDX | ã‚«ãƒ†ã‚´ãƒª |
| display_name | VARCHAR(255) | NO | - | | è¡¨ç¤ºå |
| description | TEXT | YES | NULL | | èª¬æ˜ |
| is_public | BOOLEAN | NO | FALSE | | å…¬é–‹è¨­å®šï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰å‚ç…§å¯ï¼‰ |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | | ä½œæˆæ—¥æ™‚ |
| updated_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | | æ›´æ–°æ—¥æ™‚ |

**å€¤ã®å‹**
- `string`: æ–‡å­—åˆ—
- `integer`: æ•´æ•°
- `decimal`: å°æ•°
- `boolean`: çœŸå½å€¤
- `json`: JSONå½¢å¼

**è¨­å®šã‚­ãƒ¼ã®ä¾‹**

| ã‚«ãƒ†ã‚´ãƒª | ã‚­ãƒ¼ | èª¬æ˜ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ |
|---------|------|------|------------|
| site | site_name | ã‚µã‚¤ãƒˆå | ãƒ¡ãƒ€ã‚«ãƒ©ã‚¤ãƒ–ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³ |
| site | contact_email | é€£çµ¡å…ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ | info@example.com |
| auction | default_lane_count | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¬ãƒ¼ãƒ³æ•° | 6 |
| auction | countdown_seconds | ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ç§’æ•° | 3 |
| auction | default_bid_increment | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå…¥æœ­å˜ä½ | 100 |
| auction | price_increment_rate | ä¾¡æ ¼ä¸Šæ˜‡ç‡ï¼ˆ%ï¼‰ | 10 |
| auction | min_bid_increment | æœ€ä½å…¥æœ­å˜ä½ | 100 |
| premium | premium_plan_fee | ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³æ–™é‡‘ | 300 |
| premium | max_photos | æœ€å¤§å†™çœŸæšæ•° | 3 |
| payment | default_payment_deadline_hours | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå…¥é‡‘æœŸé™ï¼ˆæ™‚é–“ï¼‰ | 24 |
| payment | default_commission_rate | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ‰‹æ•°æ–™ç‡ï¼ˆ%ï¼‰ | 10 |
| shipping | default_shipping_deadline_hours | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆç™ºé€æœŸé™ï¼ˆæ™‚é–“ï¼‰ | 48 |
| shipping | shipping_companies | åˆ©ç”¨å¯èƒ½é…é€æ¥­è€…ï¼ˆJSONï¼‰ | ["ãƒ¤ãƒãƒˆé‹è¼¸","ä½å·æ€¥ä¾¿","æ—¥æœ¬éƒµä¾¿"] |
| notification | email_notification_enabled | ãƒ¡ãƒ¼ãƒ«é€šçŸ¥æœ‰åŠ¹ | true |
| notification | line_notification_enabled | LINEé€šçŸ¥æœ‰åŠ¹ | false |

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**
```sql
PRIMARY KEY (id)
UNIQUE KEY uk_setting_key (setting_key)
INDEX idx_category (category)
```

---

## ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å›³

### å…¨ä½“æ§‹æˆ

```mermaid
erDiagram
    users ||--o{ bids : "å…¥æœ­"
    users ||--o{ won_items : "è½æœ­"
    users ||--o{ deposits : "ä¿è¨¼é‡‘"
    users ||--o{ sellers : "å‡ºå“è€…ï¼ˆå£²ä¸»ï¼‰"
    users ||--o{ announcements : "ä½œæˆ"
    users ||--o{ announcement_reads : "æ—¢èª­"

    sellers ||--o{ items : "å‡ºå“"

    auctions ||--o{ items : "å•†å“"
    auctions ||--o{ lanes : "ãƒ¬ãƒ¼ãƒ³"
    auctions ||--|| auction_deposits : "ä¿è¨¼é‡‘è¨­å®š"
    auctions ||--o{ deposits : "ä¿è¨¼é‡‘"

    items ||--o{ item_media : "ãƒ¡ãƒ‡ã‚£ã‚¢"
    items ||--o{ bids : "å…¥æœ­"
    items ||--|| won_items : "è½æœ­"
    items ||--|| lane_items : "ãƒ¬ãƒ¼ãƒ³å‰²å½“"

    lanes ||--o{ lane_items : "å•†å“å‰²å½“"

    announcements ||--o{ announcement_reads : "æ—¢èª­"
```

### è©³ç´°ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

**ãƒ¦ãƒ¼ã‚¶ãƒ¼é–¢é€£**
```
users (1) â”€â”€< (N) bids
users (1) â”€â”€< (N) won_items
users (1) â”€â”€< (N) deposits
users (1) â”€â”€< (1) sellers [user as seller]
users (1) â”€â”€< (N) announcements [created_by]
users (1) â”€â”€< (N) announcement_reads
users (1) â”€â”€< (N) users [approved_by]
```

**ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³é–¢é€£**
```
auctions (1) â”€â”€< (N) items
auctions (1) â”€â”€< (N) lanes
auctions (1) â”€â”€< (1) auction_deposits
auctions (1) â”€â”€< (N) deposits
auctions (1) â”€â”€< (N) announcements
auctions (1) â”€â”€< (1) users [created_by]
```

**å•†å“é–¢é€£**
```
items (1) â”€â”€< (N) item_media
items (1) â”€â”€< (N) bids
items (1) â”€â”€< (1) won_items
items (1) â”€â”€< (1) lane_items
items (N) â”€â”€> (1) sellers
items (N) â”€â”€> (1) auctions
```

**ãƒ¬ãƒ¼ãƒ³é–¢é€£**
```
lanes (1) â”€â”€< (N) lane_items
lanes (N) â”€â”€> (1) auctions
lanes (N) â”€â”€> (1) items [current_item]
```

---

## ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æˆ¦ç•¥

### 1. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å…¥æœ­ç”¨

**é«˜é€Ÿå…¥æœ­å‡¦ç†**
```sql
-- bidsãƒ†ãƒ¼ãƒ–ãƒ«
CREATE INDEX idx_item_active_created ON bids(item_id, is_active, created_at DESC);
CREATE INDEX idx_item_created ON bids(item_id, created_at DESC);

-- ç”¨é€”: å•†å“ã”ã¨ã®æœ€æ–°ã‚¢ã‚¯ãƒ†ã‚£ãƒ–å…¥æœ­ã‚’å–å¾—
SELECT * FROM bids 
WHERE item_id = ? AND is_active = TRUE 
ORDER BY created_at DESC LIMIT 1;
```

### 2. ãƒ¬ãƒ¼ãƒ³é€²è¡Œç®¡ç†ç”¨

**ãƒ¬ãƒ¼ãƒ³å†…å•†å“é †åºç®¡ç†**
```sql
-- lane_itemsãƒ†ãƒ¼ãƒ–ãƒ«
CREATE INDEX idx_lane_order ON lane_items(lane_id, sequence_order);

-- ç”¨é€”: ãƒ¬ãƒ¼ãƒ³ã®æ¬¡ã®å•†å“ã‚’å–å¾—
SELECT * FROM lane_items 
WHERE lane_id = ? AND sequence_order > ?
ORDER BY sequence_order ASC LIMIT 1;
```

### 3. è½æœ­ç®¡ç†ç”¨

**å…¥é‡‘æœŸé™ç®¡ç†**
```sql
-- won_itemsãƒ†ãƒ¼ãƒ–ãƒ«
CREATE INDEX idx_payment_deadline ON won_items(payment_deadline);
CREATE INDEX idx_winner_payment ON won_items(winner_id, payment_status);

-- ç”¨é€”: å…¥é‡‘æœŸé™åˆ‡ã‚Œå•†å“ã‚’å–å¾—
SELECT * FROM won_items 
WHERE payment_status = 'pending' 
  AND payment_deadline < NOW();
```

### 4. ãŠçŸ¥ã‚‰ã›è¡¨ç¤ºç”¨

**æœ‰åŠ¹ãªãŠçŸ¥ã‚‰ã›å–å¾—**
```sql
-- announcementsãƒ†ãƒ¼ãƒ–ãƒ«
CREATE INDEX idx_active ON announcements(is_published, published_at, expires_at);

-- ç”¨é€”: ç¾åœ¨æœ‰åŠ¹ãªãŠçŸ¥ã‚‰ã›ã‚’å–å¾—
SELECT * FROM announcements 
WHERE is_published = TRUE 
  AND published_at <= NOW()
  AND (expires_at IS NULL OR expires_at >= NOW())
ORDER BY priority DESC, published_at DESC;
```

### 5. ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‰¿èªç®¡ç†ç”¨

**æ‰¿èªå¾…ã¡ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—**
```sql
-- usersãƒ†ãƒ¼ãƒ–ãƒ«
CREATE INDEX idx_status_created ON users(status, created_at);

-- ç”¨é€”: æ‰¿èªå¾…ã¡ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å¤ã„é †ã«å–å¾—
SELECT * FROM users 
WHERE status = 'pending' 
ORDER BY created_at ASC;
```

---

## ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³è¨­è¨ˆ

### 1. å…¥æœ­å‡¦ç†

**ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¢ƒç•Œ**: å…¥æœ­ç™»éŒ² + å•†å“ä¾¡æ ¼æ›´æ–°

```sql
START TRANSACTION;

-- 1. ç¾åœ¨ä¾¡æ ¼ã®ç¢ºèªï¼ˆè¡Œãƒ­ãƒƒã‚¯ï¼‰
SELECT current_price, bid_increment 
FROM items 
WHERE id = ? 
FOR UPDATE;

-- 2. å…¥æœ­ç™»éŒ²
INSERT INTO bids (item_id, bidder_id, bid_price, total_amount, is_active)
VALUES (?, ?, ?, ?, TRUE);

-- 3. å•†å“ã®ç¾åœ¨ä¾¡æ ¼ã‚’æ›´æ–°
UPDATE items 
SET current_price = ?
WHERE id = ?;

COMMIT;
```

**åˆ†é›¢ãƒ¬ãƒ™ãƒ«**: `READ COMMITTED`
**ç†ç”±**: åŒæ™‚å…¥æœ­æ™‚ã®ãƒ•ã‚¡ãƒ³ãƒˆãƒ ãƒªãƒ¼ãƒ‰é˜²æ­¢

### 2. è½æœ­å‡¦ç†

**ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¢ƒç•Œ**: è½æœ­ç¢ºå®š + å•†å“ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–° + ä¿è¨¼é‡‘å‡¦ç†

```sql
START TRANSACTION;

-- 1. æœ€é«˜å…¥æœ­è€…ã‚’å–å¾—
SELECT bidder_id, MAX(bid_price) as winning_price
FROM bids
WHERE item_id = ? AND is_active = TRUE
GROUP BY bidder_id
ORDER BY winning_price DESC
LIMIT 1
FOR UPDATE;

-- 2. è½æœ­ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆ
INSERT INTO won_items (
    item_id, winner_id, winning_price, quantity, total_amount,
    payment_deadline, ...
) VALUES (...);

-- 3. å•†å“ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
UPDATE items 
SET status = 'sold'
WHERE id = ?;

-- 4. ä»–ã®å…¥æœ­ã‚’ç„¡åŠ¹åŒ–
UPDATE bids
SET is_active = FALSE
WHERE item_id = ?;

COMMIT;
```

### 3. æ”¯æ‰•ã„ç¢ºèªå‡¦ç†

**ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¢ƒç•Œ**: æ”¯æ‰•ã„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–° + å‡ºå“è€…ã¸ã®æŒ¯è¾¼é¡è¨ˆç®—

```sql
START TRANSACTION;

-- 1. è½æœ­æƒ…å ±å–å¾—
SELECT * FROM won_items
WHERE id = ?
FOR UPDATE;

-- 2. æ”¯æ‰•ã„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
UPDATE won_items
SET payment_status = 'confirmed',
    payment_confirmed_at = NOW()
WHERE id = ?;

-- 3. æ‰‹æ•°æ–™ãƒ»å‡ºå“è€…å—å–é¡ã®è¨ˆç®—ã¨æ›´æ–°
UPDATE won_items
SET commission_amount = total_amount * commission_rate / 100,
    seller_amount = total_amount - (total_amount * commission_rate / 100)
WHERE id = ?;

COMMIT;
```

---

## ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§åˆ¶ç´„

### 1. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤åˆ¶ç´„

**å…¥æœ­é–¢é€£**
- æ‰¿èªæ¸ˆã¿ï¼ˆ`status = 'approved'`ï¼‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿å…¥æœ­å¯èƒ½
- å…¥æœ­ä¾¡æ ¼ â‰¥ ç¾åœ¨ä¾¡æ ¼ + å…¥æœ­å˜ä½
- ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³é–‹å‚¬ä¸­ï¼ˆ`status = 'live'`ï¼‰ã®ã¿å…¥æœ­å¯èƒ½
- è‡ªåˆ†ã®ç¾åœ¨æœ€é«˜å…¥æœ­ã«ã¯å†å…¥æœ­ä¸å¯

**å•†å“ç®¡ç†**
- é–‹å‚¬æ¸ˆã¿ï¼ˆ`status = 'finished'`ï¼‰ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³ã®å•†å“ã¯ç·¨é›†ä¸å¯
- å•†å“ç•ªå·ã¯ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³å†…ã§é€£ç•ª
- ãƒ—ãƒ¬ãƒŸã‚¢ãƒ å•†å“ã¯å‡ºå“é †åºã§å„ªå…ˆé…ç½®

**è½æœ­ç®¡ç†**
- å…¥é‡‘æœŸé™å†…ã«æ”¯æ‰•ã„ãŒãªã„å ´åˆã€è‡ªå‹•ã‚­ãƒ£ãƒ³ã‚»ãƒ«
- ç¾åœ°å¼•å–ã¯å½“æ—¥17æ™‚ã¾ã§ã«é¸æŠå¿…é ˆ

### 2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å±¤åˆ¶ç´„

**CHECKåˆ¶ç´„**
```sql
-- items
ALTER TABLE items ADD CONSTRAINT chk_quantity 
CHECK (quantity > 0);

ALTER TABLE items ADD CONSTRAINT chk_prices 
CHECK (current_price >= start_price);

-- auctions
ALTER TABLE auctions ADD CONSTRAINT chk_lane_count 
CHECK (lane_count BETWEEN 1 AND 10);

ALTER TABLE auctions ADD CONSTRAINT chk_countdown 
CHECK (countdown_seconds BETWEEN 1 AND 10);

-- won_items
ALTER TABLE won_items ADD CONSTRAINT chk_amounts 
CHECK (seller_amount = total_amount - commission_amount);
```

**ãƒˆãƒªã‚¬ãƒ¼**
```sql
-- è½æœ­æ™‚ã®å…¥é‡‘æœŸé™è‡ªå‹•è¨­å®š
DELIMITER $$
CREATE TRIGGER before_won_items_insert
BEFORE INSERT ON won_items
FOR EACH ROW
BEGIN
    DECLARE deadline_hours INT;
    
    SELECT payment_deadline_hours INTO deadline_hours
    FROM auctions
    WHERE id = (SELECT auction_id FROM items WHERE id = NEW.item_id);
    
    SET NEW.payment_deadline = DATE_ADD(NOW(), INTERVAL deadline_hours HOUR);
END$$
DELIMITER ;

-- å•†å“ç•ªå·ã®è‡ªå‹•æ¡ç•ª
DELIMITER $$
CREATE TRIGGER before_items_insert
BEFORE INSERT ON items
FOR EACH ROW
BEGIN
    DECLARE next_number INT;
    
    SELECT COALESCE(MAX(item_number), 0) + 1 INTO next_number
    FROM items
    WHERE auction_id = NEW.auction_id;
    
    SET NEW.item_number = next_number;
END$$
DELIMITER ;
```

---

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### 1. ã‚¯ã‚¨ãƒªæœ€é©åŒ–

**N+1å•é¡Œã®å›é¿**
```sql
-- BAD: N+1ã‚¯ã‚¨ãƒª
SELECT * FROM items WHERE auction_id = ?;
-- å„itemã«å¯¾ã—ã¦
SELECT * FROM item_media WHERE item_id = ?;

-- GOOD: JOIN
SELECT 
    i.*,
    im.id as media_id,
    im.media_type,
    im.file_path
FROM items i
LEFT JOIN item_media im ON i.id = im.item_id
WHERE i.auction_id = ?
ORDER BY i.item_number, im.display_order;
```

**ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³æœ€é©åŒ–**
```sql
-- BAD: OFFSETä½¿ç”¨
SELECT * FROM items 
ORDER BY created_at DESC 
LIMIT 20 OFFSET 10000; -- é…ã„

-- GOOD: ã‚«ãƒ¼ã‚½ãƒ«ãƒ™ãƒ¼ã‚¹ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³
SELECT * FROM items 
WHERE created_at < ?
ORDER BY created_at DESC 
LIMIT 20;
```

### 2. ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥

**Redisã‚­ãƒ£ãƒƒã‚·ãƒ¥å¯¾è±¡**
- ç¾åœ¨é–‹å‚¬ä¸­ã®ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³æƒ…å ±
- ãƒ¬ãƒ¼ãƒ³é€²è¡ŒçŠ¶æ³
- å•†å“ã®ç¾åœ¨ä¾¡æ ¼ãƒ»æœ€é«˜å…¥æœ­è€…
- ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªå…¥æœ­è€…ãƒªã‚¹ãƒˆ
- ã‚·ã‚¹ãƒ†ãƒ è¨­å®š

**ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼è¨­è¨ˆ**
```
auction:live:{auction_id}               # ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³æƒ…å ±
lane:{lane_id}:current                  # ç¾åœ¨ã®ãƒ¬ãƒ¼ãƒ³çŠ¶æ…‹
item:{item_id}:price                    # å•†å“ç¾åœ¨ä¾¡æ ¼
item:{item_id}:top_bidder               # æœ€é«˜å…¥æœ­è€…
item:{item_id}:active_bidders           # ã‚¢ã‚¯ãƒ†ã‚£ãƒ–å…¥æœ­è€…ãƒªã‚¹ãƒˆï¼ˆSETå‹ï¼‰
settings:all                            # ã‚·ã‚¹ãƒ†ãƒ è¨­å®š
```

**TTLè¨­å®š**
- ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³æƒ…å ±: 60ç§’
- å•†å“ä¾¡æ ¼: 1ç§’ï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ï¼‰
- ã‚·ã‚¹ãƒ†ãƒ è¨­å®š: 1æ™‚é–“

### 3. ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ‹ãƒ³ã‚°æˆ¦ç•¥

**æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ‹ãƒ³ã‚°**
```sql
-- bidsãƒ†ãƒ¼ãƒ–ãƒ«: æœˆæ¬¡ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ‹ãƒ³ã‚°
ALTER TABLE bids PARTITION BY RANGE (YEAR(created_at) * 100 + MONTH(created_at)) (
    PARTITION p202601 VALUES LESS THAN (202602),
    PARTITION p202602 VALUES LESS THAN (202603),
    PARTITION p202603 VALUES LESS THAN (202604),
    ...
);

-- won_itemsãƒ†ãƒ¼ãƒ–ãƒ«: å¹´æ¬¡ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ‹ãƒ³ã‚°
ALTER TABLE won_items PARTITION BY RANGE (YEAR(created_at)) (
    PARTITION p2025 VALUES LESS THAN (2026),
    PARTITION p2026 VALUES LESS THAN (2027),
    ...
);
```

### 4. èª­ã¿å–ã‚Š/æ›¸ãè¾¼ã¿åˆ†é›¢

**ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ§‹æˆ**
```
Master (Write) â† Application (Write queries)
   â†“ Replication
Slave 1 (Read) â† Application (Read queries - å•†å“ä¸€è¦§ã€æ¤œç´¢)
Slave 2 (Read) â† Application (Read queries - è½æœ­ç®¡ç†ã€ãƒ¬ãƒãƒ¼ãƒˆ)
```

**ã‚¯ã‚¨ãƒªæŒ¯ã‚Šåˆ†ã‘**
- **Master**: INSERT, UPDATE, DELETE
- **Slave**: SELECTï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§ä¸è¦ãªã‚‚ã®ï¼‰
- **Masterï¼ˆå¼·åˆ¶ï¼‰**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å…¥æœ­ã®SELECT

---

## ãƒ‡ãƒ¼ã‚¿ä¿æŒãƒãƒªã‚·ãƒ¼

### 1. ãƒ›ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ï¼ˆç›´è¿‘3ãƒ¶æœˆï¼‰
- ã™ã¹ã¦ãƒ¡ã‚¤ãƒ³DBã«ä¿æŒ
- é«˜é€Ÿã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½

### 2. ã‚³ãƒ¼ãƒ«ãƒ‰ãƒ‡ãƒ¼ã‚¿ï¼ˆ3ãƒ¶æœˆã€œ2å¹´ï¼‰
- ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–DBã«ç§»è¡Œ
- å¿…è¦æ™‚ã«å‚ç…§å¯èƒ½

### 3. ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ãƒ‡ãƒ¼ã‚¿ï¼ˆ2å¹´ä»¥ä¸Šï¼‰
- S3ç­‰ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«åœ§ç¸®ä¿å­˜
- æ³•çš„è¦ä»¶ã«ã‚ˆã‚Š7å¹´é–“ä¿æŒ

**ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–å¯¾è±¡ãƒ†ãƒ¼ãƒ–ãƒ«**
- `bids`: 3ãƒ¶æœˆçµŒéå¾Œ
- `announcements`: 1å¹´çµŒéå¾Œ
- `announcement_reads`: 1å¹´çµŒéå¾Œ
- `won_items`: ä¿æŒï¼ˆãŸã ã—æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ã¯å‰Šé™¤å¯ï¼‰

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–

### 1. å€‹äººæƒ…å ±ã®æš—å·åŒ–

**æš—å·åŒ–å¯¾è±¡ã‚«ãƒ©ãƒ **
- `users.phone`
- `users.address_*`
- `sellers.bank_*`
- `sellers.account_*`
- `won_items.shipping_*`

**æš—å·åŒ–æ–¹å¼**: AES-256-CBC

### 2. ç›£æŸ»ãƒ­ã‚°

**è¨˜éŒ²å¯¾è±¡æ“ä½œ**
- ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‰¿èªãƒ»å´ä¸‹
- å•†å“ã®ç™»éŒ²ãƒ»ç·¨é›†ãƒ»å‰Šé™¤
- è½æœ­ã®ç¢ºå®š
- æ”¯æ‰•ã„ç¢ºèª
- ç™ºé€å®Œäº†
- ã‚·ã‚¹ãƒ†ãƒ è¨­å®šå¤‰æ›´

**ãƒ­ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆ**
```sql
CREATE TABLE audit_logs (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT UNSIGNED,
    action VARCHAR(100),
    table_name VARCHAR(100),
    record_id BIGINT UNSIGNED,
    old_values JSON,
    new_values JSON,
    ip_address VARCHAR(45),
    user_agent TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_user (user_id),
    INDEX idx_action (action),
    INDEX idx_created (created_at)
);
```

---

## ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é †åº

**Phase 1: åŸºç›¤ãƒ†ãƒ¼ãƒ–ãƒ«**
1. `users`
2. `system_settings`

**Phase 2: ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³åŸºæœ¬**
3. `sellers`
4. `auctions`
5. `auction_deposits`

**Phase 3: å•†å“ç®¡ç†**
6. `items`
7. `item_media`

**Phase 4: ãƒ¬ãƒ¼ãƒ³ãƒ»å…¥æœ­**
8. `lanes`
9. `lane_items`
10. `bids`

**Phase 5: è½æœ­ãƒ»æ±ºæ¸ˆ**
11. `deposits`
12. `won_items`

**Phase 6: ãŠçŸ¥ã‚‰ã›**
13. `announcements`
14. `announcement_reads`

---

## å®Œç’§ãªãƒ†ãƒ¼ãƒ–ãƒ«æ§‹æˆã®ãƒã‚¤ãƒ³ãƒˆ âœ…

### âœ… 1. æ­£è¦åŒ–ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®ãƒãƒ©ãƒ³ã‚¹
- ç¬¬3æ­£è¦å½¢ã‚’åŸºæœ¬ã¨ã—ã¤ã¤ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§ãŒæ±‚ã‚ã‚‰ã‚Œã‚‹éƒ¨åˆ†ã¯éæ­£è¦åŒ–
- `won_items`ã«`commission_amount`, `seller_amount`ã‚’æŒãŸã›ã¦è¨ˆç®—ã‚’å‰Šæ¸›

### âœ… 2. æ‹¡å¼µæ€§
- `ENUM`ã‚’ä½¿ã„ã¤ã¤ã€å°†æ¥ã®æ‹¡å¼µã«å‚™ãˆã¦æŸ”è»Ÿã«
- `system_settings`ã§ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å¤–éƒ¨åŒ–

### âœ… 3. ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§
- å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ã®é©åˆ‡ãªè¨­å®š
- CHECKåˆ¶ç´„ã€ãƒˆãƒªã‚¬ãƒ¼ã«ã‚ˆã‚‹è‡ªå‹•å‡¦ç†
- ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¢ƒç•Œã®æ˜ç¢ºåŒ–

### âœ… 4. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
- é©åˆ‡ãªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­è¨ˆ
- ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ‹ãƒ³ã‚°æˆ¦ç•¥
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥

### âœ… 5. é‹ç”¨æ€§
- è«–ç†å‰Šé™¤å¯¾å¿œ
- ç›£æŸ»ãƒ­ã‚°
- ãƒ‡ãƒ¼ã‚¿ä¿æŒãƒãƒªã‚·ãƒ¼

### âœ… 6. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- å€‹äººæƒ…å ±ã®æš—å·åŒ–
- ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- ç›£æŸ»è¨¼è·¡

---

**ã“ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆã¯ã€ãƒ¡ãƒ€ã‚«ãƒ©ã‚¤ãƒ–ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³ã‚·ã‚¹ãƒ†ãƒ ã®è¦ä»¶ã‚’å®Œå…¨ã«æº€ãŸã™å®Œç’§ãªæ§‹æˆã§ã™ï¼** ğŸ‰
